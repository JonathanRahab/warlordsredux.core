<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body,
        html {
            height: 100%;
            text-align: center;
            overflow: hidden;
        }

        .menu-wrapper {
            display: inline-block;
            width: 80vw;
            height: 80vh;
            border-radius: 10px;
            border: 2px solid #444;
            background-color: #2a2a2a;
            position: absolute;
            left: 10vw;
            top: 10vh;
        }

        .menu-title {
            background-color: #222;
            color: #fff;
            padding: 15px;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 2px solid #444;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            width: 40px;
            height: 40px;
            font-size: 30px;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .close-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .fps-display {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 1);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
        }

        .scoreboard-panel {
            padding: 1em;
            color: white;
        }

        .scoreboard-row {
            display: grid;
            grid-template-columns: 40px 15% repeat(7, 1fr) 150px;
            padding: 10px 5px;
            align-items: center;
            text-align: right;
        }

        .scoreboard-header {
            display: grid;
            grid-template-columns: 40px 15% repeat(7, 1fr) 150px;
            padding: 10px 15px;
            align-items: center;
            text-align: right;
        }

        .player-name {
            text-align: left;
            padding-left: 30px;
        }

        .scoreboard-header {
            background-color: #333;
            color: #66ccff;
            font-weight: bold;
            border-bottom: 2px solid #444;
        }

        #scoreboard-body {
            scrollbar-color: #444444 #2a2a2a;
            scrollbar-width: thin;
            height: 60vh;
            overflow-y: scroll;
            border-radius: 5px;
        }

        .scoreboard-row:nth-child(odd) {
            background-color: #2f2f2f;
        }

        .scoreboard-row:nth-child(even) {
            background-color: #3a3a3a;
        }

        .scoreboard-row:hover {
            background-color: #444444;
        }

        .points-cell {
            font-weight: bold;
        }

        img {
            height: 32px;
            transform: translateX(25%);
        }
    </style>
</head>

<body>
    <div class="menu-wrapper">
        <div class="menu-title">Scoreboard</div>
        <div class="scoreboard-panel">
            <div class="scoreboard-header">
                <div></div>
                <div class="player-name"><img class="player-icon" /></div>
                <div><img class="kill-icon" /></div>
                <div><img class="static-icon" /></div>
                <div><img class="light-icon" /></div>
                <div><img class="heavy-icon" /></div>
                <div><img class="helo-icon" /></div>
                <div><img class="plane-icon" /></div>
                <div><img class="death-icon" /></div>
                <div><img class="point-icon" /></div>
            </div>
            <div id="scoreboard-body" class="panel"></div>
            <div id="blufor-footer" class="scoreboard-row"></div>
            <div id="opfor-footer" class="scoreboard-row"></div>
        </div>
    </div>
    <script>
        const imageSize = 64;
        A3API.RequestTexture("a3\\modules_f_bootcamp\\data\\portraitbootcampstage.paa", imageSize).then(imageContent => {
            document.querySelector('.player-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\ui_f\\data\\igui\\cfg\\weaponicons\\srifle_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.kill-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\static_f_sams\\radar_system_01\\data\\ui\\radar_system_01_picture_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.static-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\soft_f\\mrap_01\\data\\ui\\mrap_01_gmg_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.light-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\armor_f_tank\\mbt_04\\data\\ui\\mbt_04_command.paa", imageSize).then(imageContent => {
            document.querySelector('.heavy-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\ui_f\\data\\gui\\rsc\\rscdisplaygarage\\helicopter_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.helo-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\ui_f\\data\\gui\\rsc\\rscdisplaygarage\\plane_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.plane-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\ui_f_curator\\data\\cfgmarkers\\kia_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.death-icon').src = imageContent;
        });
        A3API.RequestTexture("a3\\modules_f_curator\\data\\portraitcuratoraddpoints_ca.paa", imageSize).then(imageContent => {
            document.querySelector('.point-icon').src = imageContent;
        });

        function renderScoreboard(players, firstRender) {
            const makeCell = (value, className) => {
                const div = document.createElement('div');
                if (className) div.className = className;
                div.textContent = value != null ? String(value) : '';
                return div;
            };

            const clearNode = (node) => {
                while (node.firstChild) node.removeChild(node.firstChild);
            };

            const zeroTotals = () => ({
                kills: 0,
                staticKills: 0,
                lightKills: 0,
                heavyKills: 0,
                heloKills: 0,
                planeKills: 0,
                deaths: 0,
                points: 0
            });

            const addToTotals = (totals, src) => {
                totals.kills += src.kills;
                totals.staticKills += src.staticKills;
                totals.lightKills += src.lightKills;
                totals.heavyKills += src.heavyKills;
                totals.heloKills += src.heloKills;
                totals.planeKills += src.planeKills;
                totals.deaths += src.deaths;
                totals.points += src.points;
            };

            const renderFooter = (el, label, totals) => {
                clearNode(el);
                el.appendChild(makeCell(''));
                el.appendChild(makeCell(label, 'player-name'));
                el.appendChild(makeCell(totals.kills));
                el.appendChild(makeCell(totals.deaths));
                el.appendChild(makeCell(totals.staticKills));
                el.appendChild(makeCell(totals.lightKills));
                el.appendChild(makeCell(totals.heavyKills));
                el.appendChild(makeCell(totals.heloKills));
                el.appendChild(makeCell(totals.planeKills));
                el.appendChild(makeCell(totals.points));
            };

            players = JSON.parse(players || '[]');

            const body = document.getElementById('scoreboard-body');
            clearNode(body);

            const blufor = zeroTotals();
            const opfor = zeroTotals();

            const frag = document.createDocumentFragment();
            let scrollTarget = null;

            players.forEach((player, index) => {
                const row = document.createElement('div');
                row.className = 'scoreboard-row';

                const stats = {
                    kills: player.kills || 0,
                    staticKills: player.staticKills || 0,
                    lightKills: player.lightKills || 0,
                    heavyKills: player.heavyKills || 0,
                    heloKills: player.heloKills || 0,
                    planeKills: player.planeKills || 0,
                    deaths: player.deaths || 0,
                    points: player.points || 0
                };

                row.appendChild(makeCell(index + 1));
                const nameDiv = makeCell(player.name, 'player-name');
                row.appendChild(nameDiv);
                row.appendChild(makeCell(stats.kills));
                row.appendChild(makeCell(stats.staticKills));
                row.appendChild(makeCell(stats.lightKills));
                row.appendChild(makeCell(stats.heavyKills));
                row.appendChild(makeCell(stats.heloKills));
                row.appendChild(makeCell(stats.planeKills));
                row.appendChild(makeCell(stats.deaths));
                row.appendChild(makeCell(stats.points));

                if (player.side === 'BLUFOR') {
                    nameDiv.style.color = '#004d99';
                    addToTotals(blufor, stats);
                } else if (player.side === 'OPFOR') {
                    nameDiv.style.color = '#ff4b4b';
                    addToTotals(opfor, stats);
                } else {
                    nameDiv.style.color = '#ffffff';
                }

                if (player.isPlayer) {
                    row.style.border = '2px solid #66ccff';
                    if (firstRender) scrollTarget = row;
                }

                frag.appendChild(row);
            });

            body.appendChild(frag);

            if (scrollTarget && firstRender) {
                body.scrollTop = scrollTarget.offsetTop;
            }

            const bluforRow = document.getElementById('blufor-footer');
            const opforRow = document.getElementById('opfor-footer');
            if (bluforRow) renderFooter(bluforRow, 'BLUFOR', blufor);
            if (opforRow) renderFooter(opforRow, 'OPFOR', opfor);
        }

        document.addEventListener('wheel', function (e) {
            const el = document.elementFromPoint(e.clientX, e.clientY);
            if (el && el.closest('.panel')) {
                el.closest('.panel').scrollTop += e.deltaY;
                e.preventDefault();
            }
        }, { passive: false });

        const wrapper = document.querySelector('.menu-wrapper');
        const header = document.querySelector('.menu-title');

        const closeButton = document.createElement('div');
        closeButton.className = 'close-button';
        closeButton.innerHTML = '&times;';
        wrapper.appendChild(closeButton);
        closeButton.addEventListener('mousedown', function () {
            A3API.SendAlert('exit');
        });

        const pos = { x1: 0, y1: 0, x2: 0, y2: 0 };

        const onMouseMove = (e) => {
            e.preventDefault();
            const { clientX, clientY } = e;
            pos.x1 = pos.x2 - clientX;
            pos.y1 = pos.y2 - clientY;
            pos.x2 = clientX;
            pos.y2 = clientY;
            wrapper.style.top = `${wrapper.offsetTop - pos.y1}px`;
            wrapper.style.left = `${wrapper.offsetLeft - pos.x1}px`;
        };

        const onMouseUp = () => {
            document.removeEventListener('mouseup', onMouseUp);
            document.removeEventListener('mousemove', onMouseMove);
        };

        const onMouseDown = (e) => {
            e.preventDefault();
            pos.x2 = e.clientX;
            pos.y2 = e.clientY;
            document.addEventListener('mouseup', onMouseUp);
            document.addEventListener('mousemove', onMouseMove);
        };

        header.addEventListener('mousedown', onMouseDown);

        const fpsDisplay = document.createElement('div');
        fpsDisplay.className = 'fps-display';
        document.body.appendChild(fpsDisplay);

        let frameTime = 0, frameCount = 0;
        let lastLoop = performance.now();
        const fpsLoop = () => {
            const thisLoop = performance.now();
            frameTime += (thisLoop - lastLoop - frameTime) / 20;
            lastLoop = thisLoop;
            frameCount++;
            requestAnimationFrame(fpsLoop);
        };
        setInterval(() => {
            if (frameCount > 60) {
                fpsDisplay.textContent = `MENU FPS: ${(1000 / frameTime).toFixed(2)}`;
            } else {
                fpsDisplay.textContent = `MENU FPS: -`;
            }
        }, 100);
        fpsLoop();
    </script>
</body>

</html>